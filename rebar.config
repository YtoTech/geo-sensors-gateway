{erl_opts, [fail_on_warning,
           debug_info,
           warn_unused_vars,
           warn_unused_import,
           warn_exported_vars,
           {platform_define, "^((1[89])|2)", deprecated_now}]}.

{deps, [
	{eiconv, ".*", {git, "git://github.com/zotonic/eiconv.git", {branch, "master"}}},
    {gen_smtp, ".*", {git, "git://github.com/YtoTech/gen_smtp.git", {branch, "master"}}},
    {jiffy, ".*", {git, "git://github.com/davisp/jiffy.git", {branch, "master"}}},
    {nested, ".*", {git, "git://github.com/odo/nested.git", {branch, "master"}}}
]}.

{overrides,
    [{override, eiconv,
        [
            {plugins, [pc]},
            {port_env, [
                {"darwin|freebsd|openbsd", "LDFLAGS", "$LDFLAGS -liconv"},
                {"freebsd|openbsd", "CFLAGS", "$CFLAGS -I/usr/local/include"},
                {"freebsd|openbsd", "LDFLAGS", "$LDFLAGS -L/usr/local/lib"}
            ]},

            {port_specs, [{"priv/eiconv_nif.so", ["c_src/*.c"]}]},
            {artifacts, ["priv/eiconv_nif.so"]},

            {provider_hooks, [
                {post, [
                    {compile, {pc, compile}},
                    {clean, {pc, clean}}
                ]}
            ]}
        ]
    }]
}.

{dialyzer, [
    {warnings, [underspecs]},
    {base_plt_apps, [stdlib, kernel, crypto, eiconv, gen_smtp, jiffy, nested]}
]}.

{profiles, [
    {demo, [
        {relx, [
            {release, {"GeoSensorsGatewayDemo", "0.0.1"},
                [geo_sensors_gateway]
            },

            {dev_mode, true},
            {include_erts, false},

            {extended_start_script, true}
        ]}
    ]},
    {prod, [
        {relx, [
            {release, {"GeoSensorsGateway", "0.0.1"},
                [geo_sensors_gateway]
            },

            {dev_mode, false},
            {include_erts, true},

            {extended_start_script, true}
        ]}
    ]},
    {dev, [
        % TODO How does auto really work?
        {plugins, [rebar3_auto]}
    ]}
]}.
